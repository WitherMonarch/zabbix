services:

  mysql:
    image: mariadb:10.5
    container_name: zbx-mysql            # Name of the container
    environment:
      MYSQL_ROOT_PASSWORD: Crosemont123!
      MYSQL_DATABASE: zabbix
      MYSQL_USER: zabbix
      MYSQL_PASSWORD: zabbix_pass
    volumes:
      - zabbix-db:/var/lib/mysql         # Persist database data using named volume
    restart: unless-stopped

  zabbix-server:
    image: zabbix/zabbix-server-mysql:alpine-7.0-latest
    container_name: zbx-server
    environment:
      DB_SERVER_HOST: mysql              # Hostname of the database (name of the MySQL service)
      MYSQL_DATABASE: zabbix
      MYSQL_USER: zabbix
      MYSQL_PASSWORD: zabbix_pass
    depends_on:
      - mysql
    ports:
      - "10051:10051"                    # Expose Zabbix server port
    restart: unless-stopped

  zabbix-web:
    image: zabbix/zabbix-web-nginx-mysql:alpine-7.0-latest
    container_name: zbx-web
    environment:
      DB_SERVER_HOST: mysql
      MYSQL_DATABASE: zabbix
      MYSQL_USER: zabbix
      MYSQL_PASSWORD: zabbix_pass
      ZBX_SERVER_HOST: zabbix-server
      PHP_TZ: America/Toronto
    ports:
      - "8080:8080"                      # Expose web interface on port 8080
    depends_on:
      - zabbix-server
    restart: unless-stopped

  zabbix-agent:
    image: zabbix/zabbix-agent:alpine-7.0-latest
    container_name: zbx-agent
    environment:
      - ZBX_HOSTNAME=zabbix-server-agent             # Must match Host name in Zabbix UI
      - ZBX_SERVER_HOST=zabbix-server     # Server hostname in Docker network
      - ZBX_ACTIVE=1                   # Enable active checks
    privileged: true                   # Required for host-level metrics
    volumes:
      - /:/host:ro                     # Mount entire host filesystem (read-only)
      - /proc:/host/proc:ro            # Access host process info
      - /sys:/host/sys:ro              # Access host system info
      - /var/run:/var/run              # Access host sockets (for some items)
    restart: unless-stopped


volumes:
  zabbix-db:

